{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/belai/Documents/M1/Integration/group_creation/group-creation/creation-groupes-integration/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Injectable } from '@angular/core';\nimport { AngularFirestore } from '@angular/fire/compat/firestore';\nimport { doc, getDoc, getFirestore, setDoc, getDocs, collection, query, where, updateDoc, arrayUnion, increment } from \"firebase/firestore\";\nlet DatabaseService = class DatabaseService {\n  constructor(fireservices) {\n    this.fireservices = fireservices;\n    this.db = getFirestore();\n  } // Write admin config settings in db\n\n\n  newConfig(users, groups, last, userPerGroup) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield setDoc(doc(_this.db, 'Configuration', 'configID'), {\n        CurrentGroups: 0,\n        Groups: groups,\n        Last: last,\n        NbCurrentUsers: 0,\n        Users: users,\n        UsersPerGroup: userPerGroup\n      });\n    })();\n  } // Read admin config settings from db\n\n\n  getConfig() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const docRef = doc(_this2.db, \"Configuration\", \"configID\");\n      const docSnap = yield getDoc(docRef);\n\n      if (docSnap.exists()) {\n        console.log(\"Document data:\", docSnap.data());\n      } else {\n        console.log(\"No such document!\");\n      }\n    })();\n  } // Read nb groups created from db\n\n\n  createdGrp() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      const docRef = doc(_this3.db, \"Groups\", \"groupsCreated\");\n      const docSnap = yield getDoc(docRef);\n      let data;\n\n      if (docSnap.exists()) {\n        try {\n          data = docSnap.data().created;\n          return data;\n        } catch (err) {\n          console.error(err);\n          return 'err';\n        }\n      } else {\n        return -1;\n      }\n    })();\n  } // Get users without a groups\n\n\n  getUsersWithoutGroup() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      let list = [];\n      const userRef = collection(_this4.db, \"Users\");\n      const q = query(userRef, where(\"Group\", \"==\", 0));\n      const snapShot = getDocs(q);\n      (yield snapShot).forEach(doc => {\n        list.push(doc.data()[\"Name\"]);\n      });\n      return list;\n    })();\n  } // Get incomplete groups\n\n\n  getIncompleteGroups() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      let list = [],\n          id;\n      const userRef = collection(_this5.db, \"Groups\");\n      const q = query(userRef, where(\"FreePlace\", \"!=\", 0));\n      const snapShot = getDocs(q);\n      (yield snapShot).forEach(doc => {\n        id = doc.data()[\"Id\"];\n        list.push(id);\n      });\n      return list;\n    })();\n  } // Put a user in random group\n\n\n  putInRandomGroup(username, random) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      let group = \"Group\" + random;\n      yield updateDoc(doc(_this6.db, 'Groups', group), {\n        Users: arrayUnion(username),\n        FreePlace: increment(-1)\n      });\n      yield updateDoc(doc(_this6.db, \"Users\", username), {\n        Group: parseInt(random)\n      });\n    })();\n  } // Get group name\n\n\n  getGroupName(username) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      let group;\n      const userRef = collection(_this7.db, \"Users\");\n      const q = query(userRef, where(\"Name\", \"==\", username));\n      const snapShot = getDocs(q);\n      (yield snapShot).forEach(doc => {\n        group = doc.data()[\"Group\"];\n      });\n      return group;\n    })();\n  } // Get users of group\n\n\n  getUsers(groupId) {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      let list = [],\n          user;\n      const userRef = collection(_this8.db, \"Groups\");\n      const q = query(userRef, where(\"Id\", \"==\", groupId));\n      const snapShot = getDocs(q);\n      (yield snapShot).forEach(doc => {\n        user = doc.data()[\"Users\"];\n        list.push(user);\n      });\n      return list;\n    })();\n  } // Get all created groups\n\n\n  getCreatedGroups() {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      let groupNames = [];\n      const userRef = collection(_this9.db, \"Groups\");\n      const snapShot = getDocs(userRef);\n      (yield snapShot).forEach(doc => {\n        groupNames[doc.data()[\"Id\"]] = doc.data()[\"Users\"];\n      });\n      return groupNames;\n    })();\n  } // Remove user from group\n\n\n  removeFromGroup(username, id) {\n    var _this10 = this;\n\n    return _asyncToGenerator(function* () {\n      yield updateDoc(doc(_this10.db, 'Users', username), {\n        Group: 0\n      });\n      let list = [],\n          user;\n      const userRef = collection(_this10.db, \"Groups\");\n      const q = query(userRef, where(\"Id\", \"==\", id));\n      const snapShot = getDocs(q);\n      (yield snapShot).forEach(doc => {\n        user = doc.data()[\"Users\"];\n        list.push(user);\n      });\n      let finalList = [],\n          j = 0;\n\n      for (let i = 0; i < list[0].length; i++) {\n        if (list[0][i] !== username) {\n          finalList[j] = list[0][i];\n          j++;\n        }\n      }\n\n      yield updateDoc(doc(_this10.db, 'Groups', \"Group\" + id), {\n        FreePlace: increment(1),\n        Users: finalList\n      });\n    })();\n  } // Register username if login for first time\n\n\n  logInName(username) {\n    var _this11 = this;\n\n    return _asyncToGenerator(function* () {\n      const userRef = collection(_this11.db, \"Users\");\n      const q = query(userRef, where(\"Name\", \"==\", username));\n      const snapShot = getDocs(q);\n      const refUsersCurrent = yield getDoc(doc(_this11.db, \"Configuration\", \"configID\"));\n      const usersCurrent = refUsersCurrent.data()[\"NbCurrentUsers\"];\n      const refUsersMax = yield getDoc(doc(_this11.db, \"Configuration\", \"configID\"));\n      const usersMax = refUsersMax.data()[\"Users\"];\n\n      if (usersCurrent < usersMax) {\n        if ((yield snapShot).empty) {\n          yield setDoc(doc(_this11.db, 'Users', username), {\n            Group: 0,\n            Name: username\n          });\n          yield updateDoc(doc(_this11.db, \"Configuration\", \"configID\"), {\n            NbCurrentUsers: increment(1)\n          });\n        }\n\n        return true;\n      } else {\n        if ((yield snapShot).empty) {\n          return false;\n        }\n\n        return true;\n      }\n    })();\n  } // Delete group\n\n\n  deleteGrp(id) {\n    const groupRef = collection(this.db, \"Groups\");\n  }\n\n};\n\nDatabaseService.ctorParameters = () => [{\n  type: AngularFirestore\n}];\n\nDatabaseService = __decorate([Injectable({\n  providedIn: 'root'\n})], DatabaseService);\nexport { DatabaseService };","map":{"version":3,"sources":["C:/Users/belai/Documents/M1/Integration/group_creation/group-creation/creation-groupes-integration/src/app/services/database.service.ts"],"names":["__decorate","Injectable","AngularFirestore","doc","getDoc","getFirestore","setDoc","getDocs","collection","query","where","updateDoc","arrayUnion","increment","DatabaseService","constructor","fireservices","db","newConfig","users","groups","last","userPerGroup","CurrentGroups","Groups","Last","NbCurrentUsers","Users","UsersPerGroup","getConfig","docRef","docSnap","exists","console","log","data","createdGrp","created","err","error","getUsersWithoutGroup","list","userRef","q","snapShot","forEach","push","getIncompleteGroups","id","putInRandomGroup","username","random","group","FreePlace","Group","parseInt","getGroupName","getUsers","groupId","user","getCreatedGroups","groupNames","removeFromGroup","finalList","j","i","length","logInName","refUsersCurrent","usersCurrent","refUsersMax","usersMax","empty","Name","deleteGrp","groupRef","ctorParameters","type","providedIn"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\r\nimport { Injectable } from '@angular/core';\r\nimport { AngularFirestore } from '@angular/fire/compat/firestore';\r\nimport { doc, getDoc, getFirestore, setDoc, getDocs, collection, query, where, updateDoc, arrayUnion, increment } from \"firebase/firestore\";\r\nlet DatabaseService = class DatabaseService {\r\n    constructor(fireservices) {\r\n        this.fireservices = fireservices;\r\n        this.db = getFirestore();\r\n    }\r\n    // Write admin config settings in db\r\n    async newConfig(users, groups, last, userPerGroup) {\r\n        await setDoc(doc(this.db, 'Configuration', 'configID'), {\r\n            CurrentGroups: 0,\r\n            Groups: groups,\r\n            Last: last,\r\n            NbCurrentUsers: 0,\r\n            Users: users,\r\n            UsersPerGroup: userPerGroup,\r\n        });\r\n    }\r\n    // Read admin config settings from db\r\n    async getConfig() {\r\n        const docRef = doc(this.db, \"Configuration\", \"configID\");\r\n        const docSnap = await getDoc(docRef);\r\n        if (docSnap.exists()) {\r\n            console.log(\"Document data:\", docSnap.data());\r\n        }\r\n        else {\r\n            console.log(\"No such document!\");\r\n        }\r\n    }\r\n    // Read nb groups created from db\r\n    async createdGrp() {\r\n        const docRef = doc(this.db, \"Groups\", \"groupsCreated\");\r\n        const docSnap = await getDoc(docRef);\r\n        let data;\r\n        if (docSnap.exists()) {\r\n            try {\r\n                data = docSnap.data().created;\r\n                return data;\r\n            }\r\n            catch (err) {\r\n                console.error(err);\r\n                return 'err';\r\n            }\r\n        }\r\n        else {\r\n            return -1;\r\n        }\r\n    }\r\n    // Get users without a groups\r\n    async getUsersWithoutGroup() {\r\n        let list = [];\r\n        const userRef = collection(this.db, \"Users\");\r\n        const q = query(userRef, where(\"Group\", \"==\", 0));\r\n        const snapShot = getDocs(q);\r\n        (await snapShot).forEach((doc) => {\r\n            list.push(doc.data()[\"Name\"]);\r\n        });\r\n        return list;\r\n    }\r\n    // Get incomplete groups\r\n    async getIncompleteGroups() {\r\n        let list = [], id;\r\n        const userRef = collection(this.db, \"Groups\");\r\n        const q = query(userRef, where(\"FreePlace\", \"!=\", 0));\r\n        const snapShot = getDocs(q);\r\n        (await snapShot).forEach((doc) => {\r\n            id = doc.data()[\"Id\"];\r\n            list.push(id);\r\n        });\r\n        return list;\r\n    }\r\n    // Put a user in random group\r\n    async putInRandomGroup(username, random) {\r\n        let group = \"Group\" + random;\r\n        await updateDoc(doc(this.db, 'Groups', group), {\r\n            Users: arrayUnion(username),\r\n            FreePlace: increment(-1)\r\n        });\r\n        await updateDoc(doc(this.db, \"Users\", username), {\r\n            Group: parseInt(random)\r\n        });\r\n    }\r\n    // Get group name\r\n    async getGroupName(username) {\r\n        let group;\r\n        const userRef = collection(this.db, \"Users\");\r\n        const q = query(userRef, where(\"Name\", \"==\", username));\r\n        const snapShot = getDocs(q);\r\n        (await snapShot).forEach((doc) => {\r\n            group = doc.data()[\"Group\"];\r\n        });\r\n        return group;\r\n    }\r\n    // Get users of group\r\n    async getUsers(groupId) {\r\n        let list = [], user;\r\n        const userRef = collection(this.db, \"Groups\");\r\n        const q = query(userRef, where(\"Id\", \"==\", groupId));\r\n        const snapShot = getDocs(q);\r\n        (await snapShot).forEach((doc) => {\r\n            user = doc.data()[\"Users\"];\r\n            list.push(user);\r\n        });\r\n        return list;\r\n    }\r\n    // Get all created groups\r\n    async getCreatedGroups() {\r\n        let groupNames = [];\r\n        const userRef = collection(this.db, \"Groups\");\r\n        const snapShot = getDocs(userRef);\r\n        (await snapShot).forEach((doc) => {\r\n            groupNames[doc.data()[\"Id\"]] = doc.data()[\"Users\"];\r\n        });\r\n        return groupNames;\r\n    }\r\n    // Remove user from group\r\n    async removeFromGroup(username, id) {\r\n        await updateDoc(doc(this.db, 'Users', username), {\r\n            Group: 0\r\n        });\r\n        let list = [], user;\r\n        const userRef = collection(this.db, \"Groups\");\r\n        const q = query(userRef, where(\"Id\", \"==\", id));\r\n        const snapShot = getDocs(q);\r\n        (await snapShot).forEach((doc) => {\r\n            user = doc.data()[\"Users\"];\r\n            list.push(user);\r\n        });\r\n        let finalList = [], j = 0;\r\n        for (let i = 0; i < list[0].length; i++) {\r\n            if (list[0][i] !== username) {\r\n                finalList[j] = list[0][i];\r\n                j++;\r\n            }\r\n        }\r\n        await updateDoc(doc(this.db, 'Groups', \"Group\" + id), {\r\n            FreePlace: increment(1),\r\n            Users: finalList\r\n        });\r\n    }\r\n    // Register username if login for first time\r\n    async logInName(username) {\r\n        const userRef = collection(this.db, \"Users\");\r\n        const q = query(userRef, where(\"Name\", \"==\", username));\r\n        const snapShot = getDocs(q);\r\n        const refUsersCurrent = await getDoc(doc(this.db, \"Configuration\", \"configID\"));\r\n        const usersCurrent = refUsersCurrent.data()[\"NbCurrentUsers\"];\r\n        const refUsersMax = await getDoc(doc(this.db, \"Configuration\", \"configID\"));\r\n        const usersMax = refUsersMax.data()[\"Users\"];\r\n        if (usersCurrent < usersMax) {\r\n            if ((await snapShot).empty) {\r\n                await setDoc(doc(this.db, 'Users', username), {\r\n                    Group: 0,\r\n                    Name: username\r\n                });\r\n                await updateDoc(doc(this.db, \"Configuration\", \"configID\"), {\r\n                    NbCurrentUsers: increment(1)\r\n                });\r\n            }\r\n            return true;\r\n        }\r\n        else {\r\n            if ((await snapShot).empty) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n    // Delete group\r\n    deleteGrp(id) {\r\n        const groupRef = collection(this.db, \"Groups\");\r\n    }\r\n};\r\nDatabaseService.ctorParameters = () => [\r\n    { type: AngularFirestore }\r\n];\r\nDatabaseService = __decorate([\r\n    Injectable({\r\n        providedIn: 'root'\r\n    })\r\n], DatabaseService);\r\nexport { DatabaseService };\r\n"]},"metadata":{},"sourceType":"module"}